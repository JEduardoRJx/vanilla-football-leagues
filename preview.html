<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preview</title>
    <script type="module">
      import { createClient } from 'https://cdn.skypack.dev/@prismicio/client';

      const repositoryName = 'vanilla-leagues';
      const client = createClient(repositoryName, {
        routes: [
          {
            type: 'league',
            path: '/#/league/:uid',
          },
        ],
      });

      const init = async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (!token) {
          document.body.innerHTML = '<h1>Error: Missing preview token</h1>';
          return;
        }

        try {
          const resolvedUrl = await client.resolvePreviewURL({
            defaultURL: '/#/',
            previewToken: token,
          });

          const hashResolvedUrl = resolvedUrl.startsWith('/#/')
            ? resolvedUrl
            : `/#${resolvedUrl.slice(1)}`;

          window.location.replace(hashResolvedUrl);
        } catch (error) {
          console.error('Error resolving preview URL:', error);
          document.body.innerHTML = '<h1>Error resolving preview</h1>';
        }
      };

      init();
    </script>
  </head>
  <body>
    <h1>Loading Preview...</h1>
  </body>
</html>
